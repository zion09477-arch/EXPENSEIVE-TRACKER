<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - ExpenseTracker</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <a href="../index.html" class="logo">
                <i class="fas fa-chart-line"></i>
                ExpenseTracker
            </a>
            <ul class="nav-links">
                <li><a href="../index.html">Home</a></li>
                <li><a href="dashboard.html" class="active">Dashboard</a></li>
                <li><a href="expenses.html">Expenses</a></li>
            </ul>
            <div class="flex items-center gap-4" id="navButtons"></div>
        </div>
    </nav>

    <div class="container" style="padding: 2rem 0;">
        <div class="flex items-center justify-between mb-6">
            <div>
                <h1>Dashboard</h1>
                <p class="text-gray" id="welcomeMessage"></p>
            </div>
            <a href="expenses.html" class="btn btn-primary">
                <i class="fas fa-plus"></i>
                Add Expense
            </a>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Total Expenses</span>
                    <span class="stat-icon"><i class="fas fa-dollar-sign"></i></span>
                </div>
                <div class="stat-value" id="totalExpenses">$0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Transactions</span>
                    <span class="stat-icon"><i class="fas fa-receipt"></i></span>
                </div>
                <div class="stat-value" id="transactionCount">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Top Category</span>
                    <span class="stat-icon"><i class="fas fa-tag"></i></span>
                </div>
                <div class="stat-value" id="topCategory">-</div>
            </div>
            <div class="stat-card">
                <div class="stat-header">
                    <span class="stat-title">Average</span>
                    <span class="stat-icon"><i class="fas fa-chart-line"></i></span>
                </div>
                <div class="stat-value" id="monthlyAverage">$0</div>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <canvas id="categoryChart"></canvas>
            </div>
            <div class="chart-container">
                <canvas id="trendChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h3>Recent Transactions</h3>
                <a href="expenses.html" class="btn btn-secondary btn-sm">View All</a>
            </div>
            <div class="card-body">
                <table>
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Description</th>
                            <th>Category</th>
                            <th>Amount</th>
                        </tr>
                    </thead>
                    <tbody id="recentTransactions"></tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="../js/utils.js"></script>
    <script>
        const user = JSON.parse(localStorage.getItem('user'));
        if (!user) window.location.href = 'login.html';

        document.getElementById('navButtons').innerHTML = `
            <span class="text-sm">${user.name}</span>
            <button onclick="logout()" class="btn btn-secondary btn-sm">Logout</button>
        `;
        document.getElementById('welcomeMessage').textContent = `Welcome back, ${user.name}!`;

        // Load ONLY this user's expenses
        let expenses = JSON.parse(localStorage.getItem(`expenses_${user.id}`)) || [];
        
        // NO DEFAULT DATA - users start with empty expenses

        // Calculate stats
        const total = expenses.reduce((s, e) => s + e.amount, 0);
        document.getElementById('totalExpenses').textContent = total ? `$${total.toFixed(2)}` : '$0';
        document.getElementById('transactionCount').textContent = expenses.length;
        document.getElementById('monthlyAverage').textContent = expenses.length ? `$${(total / expenses.length).toFixed(2)}` : '$0';

        // Calculate top category
        const categories = {};
        expenses.forEach(e => categories[e.category] = (categories[e.category] || 0) + e.amount);
        const topCat = Object.entries(categories).sort((a, b) => b[1] - a[1])[0];
        document.getElementById('topCategory').textContent = topCat ? topCat[0] : '-';

        // Recent transactions
        const tbody = document.getElementById('recentTransactions');
        if (expenses.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" class="text-center">No expenses yet. Click "Add Expense" to start!</td></tr>';
        } else {
            tbody.innerHTML = expenses.slice(0, 5).map(e => `
                <tr>
                    <td>${new Date(e.date).toLocaleDateString()}</td>
                    <td>${e.description}</td>
                    <td><span class="badge">${e.category}</span></td>
                    <td>$${e.amount.toFixed(2)}</td>
                </tr>
            `).join('');
        }

        // Charts (only if there are expenses)
        if (expenses.length > 0) {
            new Chart(document.getElementById('categoryChart'), {
                type: 'doughnut',
                data: {
                    labels: Object.keys(categories),
                    datasets: [{
                        data: Object.values(categories),
                        backgroundColor: ['#4f46e5', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6']
                    }]
                }
            });
        } else {
            document.getElementById('categoryChart').getContext('2d').fillText('No data yet', 50, 50);
        }

        // Sample trend chart (you can make this dynamic too)
        new Chart(document.getElementById('trendChart'), {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                datasets: [{
                    label: 'Spending',
                    data: [0, 0, 0, 0, 0],
                    borderColor: '#4f46e5'
                }]
            }
        });
    </script>
</body>
</html>